<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Defining Operators (Optional) &mdash; Introduction to Computer Science in C# 29 Nov 2021 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter Review Questions" href="reviewclasses.html" />
    <link rel="prev" title="Classes And Structs" href="classes-and-structs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #922247" >
            <a href="../index.html" class="icon icon-home"> Introduction to Computer Science in C#
          </a>
              <div class="version">
                29 Nov 2021
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../context/context.html">Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/data.html">C# Data and Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions/functions.html">Defining Functions of your Own</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basicstringops/basicstringops.html">Basic String Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../decisions/decisions.html">Decisions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../while/while.html">While Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../foreach/foreach.html">Foreach Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../for/for.html">For Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files/files.html">Files, Paths, and Directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arrays/arrays.html">Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lists/lists.html">Lists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dictionaries/dictionaries.html">Dictionaries</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="classes.html">Classes and Object-Oriented Programming</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="a-first-class.html">A First Example of Class Instances: Contact</a></li>
<li class="toctree-l2"><a class="reference internal" href="classexamples.html">Class Instance Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="rational.html">The Rational Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="planning_classes.html">Planning A Class Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="classes-and-structs.html">Classes And Structs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Defining Operators (Optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="reviewclasses.html">Chapter Review Questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfaces/interfaces.html">Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recursion/recursion.html">Recursion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datastructures/datastructures.html">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix.html">Appendix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #922247" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Introduction to Computer Science in C#</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="classes.html">Classes and Object-Oriented Programming</a> &raquo;</li>
      <li>Defining Operators (Optional)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/classes/overload-op.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="defining-operators-optional">
<span id="defining-operators"></span><h1>Defining Operators (Optional)<a class="headerlink" href="#defining-operators-optional" title="Permalink to this headline"></a></h1>
<section id="operator-overloading">
<span id="overloading-operators"></span><span id="index-0"></span><h2>Operator Overloading<a class="headerlink" href="#operator-overloading" title="Permalink to this headline"></a></h2>
<p>The Rational class is a fine example of a useful utility class.
Still, to an experienced user, it has a striking deficiency:
A Rational is a <em>number</em> and we are used to doing arithmetic with
standard operators.  We would like to replace the mouthful
<code class="docutils literal notranslate"><span class="pre">frac1.Multiply(frac2)</span></code> by our common symbolism for multiplication,
<code class="docutils literal notranslate"><span class="pre">frac1*frac2</span></code>.  This can be coded in C#, using <em>operator overloading</em> to
give new meanings to the operator <code class="docutils literal notranslate"><span class="pre">*</span></code>.  The C# syntax is illustrated in the
variant of the Rational class in
<a class="reference external" href="https://github.com/LoyolaChicagoBooks/introcs-csharp-examples/blob/master/rational_ops_stub/rational.cs">rational_ops_stub/rational.cs</a>.  This class also contains code
discussed in the
next section, <a class="reference internal" href="#casts-in-user-classes"><span class="std std-ref">Casts in User-Defined Classes</span></a>.
Here are operator overload declarations for <code class="docutils literal notranslate"><span class="pre">*</span></code> and others:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span>      <span class="c1">/// * binary multiplication operator</span>
      <span class="k">public</span> <span class="k">static</span> <span class="n">Rational</span> <span class="k">operator</span> <span class="p">*(</span><span class="n">Rational</span> <span class="n">f1</span><span class="p">,</span> <span class="n">Rational</span> <span class="n">f2</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="k">return</span> <span class="k">new</span> <span class="nf">Rational</span><span class="p">(</span><span class="n">f1</span><span class="p">.</span><span class="n">num</span><span class="p">*</span><span class="n">f2</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="n">f1</span><span class="p">.</span><span class="n">denom</span><span class="p">*</span><span class="n">f2</span><span class="p">.</span><span class="n">denom</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">/// - unary negation operator</span>
      <span class="k">public</span> <span class="k">static</span> <span class="n">Rational</span> <span class="k">operator</span> <span class="p">-</span> <span class="p">(</span><span class="n">Rational</span> <span class="n">r</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="k">return</span> <span class="k">new</span> <span class="nf">Rational</span><span class="p">(-</span><span class="n">r</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">denom</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">/// binary == operator</span>
      <span class="k">public</span> <span class="k">static</span> <span class="n">Boolean</span> <span class="k">operator</span> <span class="p">==(</span><span class="n">Rational</span> <span class="n">f1</span><span class="p">,</span> <span class="n">Rational</span> <span class="n">f2</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="k">return</span> <span class="n">f1</span><span class="p">.</span><span class="n">num</span> <span class="p">==</span> <span class="n">f2</span><span class="p">.</span><span class="n">num</span> <span class="p">&amp;&amp;</span> <span class="n">f1</span><span class="p">.</span><span class="n">denom</span> <span class="p">==</span> <span class="n">f2</span><span class="p">.</span><span class="n">denom</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">/// binary != operator</span>
      <span class="k">public</span> <span class="k">static</span> <span class="n">Boolean</span> <span class="k">operator</span> <span class="p">!=(</span><span class="n">Rational</span> <span class="n">f1</span><span class="p">,</span> <span class="n">Rational</span> <span class="n">f2</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="k">return</span> <span class="n">f1</span><span class="p">.</span><span class="n">num</span> <span class="p">!=</span> <span class="n">f2</span><span class="p">.</span><span class="n">num</span> <span class="p">||</span> <span class="n">f1</span><span class="p">.</span><span class="n">denom</span> <span class="p">!=</span> <span class="n">f2</span><span class="p">.</span><span class="n">denom</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">// or extra call, but clearly consistent: return !(f1 == f2)</span>
</pre></div>
</div>
<p>All operator overload headings have the special form</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">static</span></code> <em>returnType</em> <code class="docutils literal notranslate"><span class="pre">operator</span></code> opSymbol <code class="docutils literal notranslate"><span class="pre">(</span></code> <em>parameters</em> <code class="docutils literal notranslate"><span class="pre">)</span></code></p>
</div></blockquote>
<p>Here opSymbol can be any arithmetic or comparison operator, or
some other operators that we have not discussed.  So something like
<code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">*</span></code> or <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">-</span></code> replaces the method name.
Binary operations like multiplication require two operands, and hence the
method has two parameters.
The method
computes and returns the named return type in the normal fashion.
In general
at least one of the parameters must be of the type of the class being defined.</p>
<p>(We could have directly defined four further overloads of <code class="docutils literal notranslate"><span class="pre">*</span></code>,
with the first or second parameter
being an <code class="docutils literal notranslate"><span class="pre">int</span></code> or a <code class="docutils literal notranslate"><span class="pre">double</span></code>, but we will avoid that by also adding methods
to provide implicit <a class="reference internal" href="#casts-in-user-classes"><span class="std std-ref">Casts in User-Defined Classes</span></a>.)</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-</span></code> symbol is special, since it can be used either as a unary operator for
negation, or as a binary operator for subtraction.  Since we include only
one parameter above, we are defining the unary version.</p>
<p>The operator does not need to produce a result of the same type.  We
included <code class="docutils literal notranslate"><span class="pre">==</span></code> and <code class="docutils literal notranslate"><span class="pre">!=</span></code> as examples (returning a <code class="docutils literal notranslate"><span class="pre">Boolean</span></code>).</p>
<p>(These methods
do not cause compiler errors, but warnings are generated:
We have not added further more advanced
overrides of Equals and HashCode methods, that are ideally in sync with
the meaning of <code class="docutils literal notranslate"><span class="pre">==</span></code>.  You should see a discussion of these methods in a
data structures course, like Loyola’s Comp 271.)</p>
<p>The class is a stub,
and <a class="reference internal" href="#overloading-operator-exercise"><span class="std std-ref">Operator Overloading Exercise</span></a>
invites you to add further operator overloads.</p>
<p id="index-1"><strong>Precedence</strong>:  Note that the operator overloading method definitions include
nothing about <a class="reference internal" href="../appendix/precedence.html#precedence"><span class="std std-ref">Precedence of Operators</span></a>. That is because the precedence of operators
is fixed across the whole language. Unary <code class="docutils literal notranslate"><span class="pre">-</span></code> has higher
precedence than <code class="docutils literal notranslate"><span class="pre">*</span></code> … no matter what the types involved.</p>
<p>An example testing class also uses the new casting syntax of next section:</p>
</section>
<section id="casts-in-user-defined-classes">
<span id="casts-in-user-classes"></span><span id="index-2"></span><h2>Casts in User-Defined Classes<a class="headerlink" href="#casts-in-user-defined-classes" title="Permalink to this headline"></a></h2>
<p>We have discussed casts before.  We know that an <code class="docutils literal notranslate"><span class="pre">int</span></code> can also be represented
as a <code class="docutils literal notranslate"><span class="pre">double</span></code> with an integer value, and the cast from <code class="docutils literal notranslate"><span class="pre">int</span></code> to <code class="docutils literal notranslate"><span class="pre">double</span></code>
is done implicitly
when needed:  An expression like <code class="docutils literal notranslate"><span class="pre">3.2</span> <span class="pre">*</span> <span class="pre">2</span></code> is processed by the compiler,
<em>implicitly</em> casting the
2 to <code class="docutils literal notranslate"><span class="pre">double</span></code> 2.0, and then doing a <code class="docutils literal notranslate"><span class="pre">double</span></code> multiplication.
The same idea makes sense with an
<code class="docutils literal notranslate"><span class="pre">int</span></code> <code class="docutils literal notranslate"><span class="pre">n</span></code> and a Rational <code class="docutils literal notranslate"><span class="pre">f</span></code>.  We only defined the operator overload <code class="docutils literal notranslate"><span class="pre">*</span></code>
for two Rationals, so in our code so far, <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">*</span> <span class="pre">n</span></code> does not make sense.
Mathematically an integer is rational, so mathematically, it should make sense.
We bridge this difference by defining an implicit cast of an <code class="docutils literal notranslate"><span class="pre">int</span></code> to a Rational,
so  the compiler will take <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">*</span> <span class="pre">n</span></code> and see the need to implicitly cast
<code class="docutils literal notranslate"><span class="pre">n</span></code> to a Rational.  The definition below will also allow explicit casts
if you choose, like <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">*</span> <span class="pre">(Rational)</span> <span class="pre">n</span></code>:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span>      <span class="c1">/// Code to cast an int to a Rational implicitly when needed.</span>
      <span class="k">public</span> <span class="k">static</span> <span class="k">implicit</span> <span class="k">operator</span> <span class="nf">Rational</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="k">return</span> <span class="k">new</span> <span class="nf">Rational</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
      <span class="p">}</span>
</pre></div>
</div>
<p>Again it is
the heading that takes a special form, starting with
<code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">static</span> <span class="pre">implicit</span> <span class="pre">operator</span></code> followed by the type being cast to,
like Rational, while the parameter is the starting type, like <code class="docutils literal notranslate"><span class="pre">int</span></code>.
This is not like a regular method with its return type and method name.
Here it looks something like a constructor with a type in place of a method
name, but a constructor would not start with <code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">implicit</span> <span class="pre">operator</span></code>!</p>
<p>Now consider a <code class="docutils literal notranslate"><span class="pre">double</span></code> <code class="docutils literal notranslate"><span class="pre">d</span></code> and a Rational <code class="docutils literal notranslate"><span class="pre">f</span></code>.
We would like to allow an expression like
<code class="docutils literal notranslate"><span class="pre">d</span> <span class="pre">*</span> <span class="pre">f</span></code>.
Again, the operator overload for <code class="docutils literal notranslate"><span class="pre">*</span></code> does not allow this directly, so consider
implicit casts:  Since
a <code class="docutils literal notranslate"><span class="pre">double</span></code> is only an approximation, in general,
it would not be wise to implicitly convert
a <code class="docutils literal notranslate"><span class="pre">double</span></code> to a Rational, but it does make sense to approximate a Rational
by a <code class="docutils literal notranslate"><span class="pre">double</span></code> before use with a <code class="docutils literal notranslate"><span class="pre">double</span></code>:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span>      <span class="c1">/// Code to cast to a double implicitly when needed.</span>
      <span class="k">public</span> <span class="k">static</span> <span class="k">implicit</span> <span class="k">operator</span> <span class="nf">double</span><span class="p">(</span><span class="n">Rational</span> <span class="n">f</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="k">return</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">f</span><span class="p">.</span><span class="n">num</span><span class="p">/</span><span class="n">f</span><span class="p">.</span><span class="n">denom</span><span class="p">;</span>
      <span class="p">}</span>
</pre></div>
</div>
<p>The general format of such an implicit cast in a user-defined class is:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">static</span> <span class="pre">implicit</span> <span class="pre">operator</span></code> <em>resultType</em> <code class="docutils literal notranslate"><span class="pre">(</span></code> <em>sourceType</em> <em>paramName</em> <code class="docutils literal notranslate"><span class="pre">)</span></code></p>
</div></blockquote>
<p>One of the two types should be the type of the containing class.
We have illustrated both combinations.</p>
<p>Finally, you need to be <em>very careful where you declare implicit casts</em>, to
make sure you are not being overly general, and maybe allowing
trouble in a form that may be very hard to debug:
It is much harder to foresee and trace implicit actions than explicit actions.
You are
<em>safe</em>, but more <em>verbose</em>, if you <em>only allow explicit</em> casts.  For example,
we have already seen these required for a cast from <code class="docutils literal notranslate"><span class="pre">double</span></code> to <code class="docutils literal notranslate"><span class="pre">int</span></code>.
To only allow an explicit cast with your type,
replace <code class="docutils literal notranslate"><span class="pre">implicit</span></code> by <code class="docutils literal notranslate"><span class="pre">explicit</span></code> in the cast method heading.</p>
<div class="highlight-csharp notranslate" id="decimal-type"><span id="index-3"></span><div class="highlight"><pre><span></span>      <span class="c1">/// Code to cast to a decimal with an explicit cast.</span>
      <span class="k">public</span> <span class="k">static</span> <span class="k">explicit</span> <span class="k">operator</span> <span class="nf">decimal</span><span class="p">(</span><span class="n">Rational</span> <span class="n">f</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="k">return</span> <span class="p">(</span><span class="kt">decimal</span><span class="p">)</span><span class="n">f</span><span class="p">.</span><span class="n">num</span><span class="p">/</span><span class="n">f</span><span class="p">.</span><span class="n">denom</span><span class="p">;</span>
      <span class="p">}</span>
</pre></div>
</div>
<p><strong>The decimal type</strong>:  Though we have not used the
<code class="docutils literal notranslate"><span class="pre">decimal</span></code> type before, we use it here for contrast to illustrate a cast
from Rational to <code class="docutils literal notranslate"><span class="pre">decimal</span></code> that can only be used explicitly, as in
<code class="docutils literal notranslate"><span class="pre">(decimal)</span> <span class="pre">f</span></code>:</p>
<p>Example
<a class="reference external" href="https://github.com/LoyolaChicagoBooks/introcs-csharp-examples/blob/master/rational_ops_stub/test_ops.cs">rational_ops_stub/test_ops.cs</a> tests all of the operator overloads
and casts shown for a Rational.  Look at the source code and run it.
Note where overloaded operators are used and where implicit and explicit casts
to or from a Rational are used.</p>
<p>The example also illustrates a special feature
of the <code class="docutils literal notranslate"><span class="pre">decimal</span></code> type.  While a <code class="docutils literal notranslate"><span class="pre">double</span></code> is encoded with a power of 2, so
0.1 is <em>not</em> stored accurately, a <code class="docutils literal notranslate"><span class="pre">decimal</span></code> is encoded with a power of 10, so
exact decimal values with up to 28 digits can be stored and manipulated.
(This is important for <em>monetary calculations</em>, so a <code class="docutils literal notranslate"><span class="pre">decimal</span></code> literal
has <strong>m</strong> for money appended, like  <code class="docutils literal notranslate"><span class="pre">5.99m</span></code>, representing the mathematical
quantity 5.99 <em>exactly</em>.)</p>
<section id="operator-overloading-exercise">
<span id="overloading-operator-exercise"></span><span id="index-4"></span><h3>Operator Overloading Exercise<a class="headerlink" href="#operator-overloading-exercise" title="Permalink to this headline"></a></h3>
<p>The classes discussed above from example project
<a class="reference external" href="https://github.com/LoyolaChicagoBooks/introcs-csharp-examples/blob/master/rational_ops_stub">rational_ops_stub</a>
are incomplete.  Add the
overloaded binary operators  /, +, -, &lt;, &gt;, &lt;= and &gt;= to the Rational class,
and extend the TestOps class to test them.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="classes-and-structs.html" class="btn btn-neutral float-left" title="Classes And Structs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reviewclasses.html" class="btn btn-neutral float-right" title="Chapter Review Questions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2012-2021, Andrew N. Harrington and George Thiruvathukal.
      <span class="lastupdated">Last updated on 29-November-2021 23:56:28.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>